# Session: 2026-01-22 (Linux)

## Summary
- Pulled latest changes and updated submodules
- data-alchemy updated to 471ea6c (ibes_rt_estimates grabber map, reuters_fundamentals fixes)
- bbocax equities DQ validation: **PASSED** (210 files/weekday, 82 files/weekend)
- Analyzed futures mapping: `futures_2_0.json` correct for `*FuturesBulk*`
- Identified need for 3 new `futures_extended` grabber maps (1.0, 2.0, 3.0)

---

## Work Log

### Environment Setup
- Updated data-alchemy submodule from e95341e to 471ea6c
- Committed submodule update to parent repo

### data-alchemy Updates (471ea6c)
- LSEG Refinitiv ibes_rt_estimates grabber map added
- reuters_fundamentals grabber map fixes
- Deployment playbooks for ibes_rt_estimates

### bbocax Equities Mapping

**Branch:** `feature/bbocax-equities`

**Files in branch (not in main):**
- `bloomberg_bbocax_cwiq_pipe_equities_1_0.json`
- `bloomberg_bbocax_cwiq_pipe_equities_parquet_1_0.json`
- `bloomberg.json` (decrypt patterns)

**Bronze File Counts (ny5-predpalch01):**

| Date | Files | Notes |
|------|-------|-------|
| 2025/12/08 | 1672 | Weekend |
| 2025/12/09 | 8226 | Full |
| 2025/12/10 | 8026 | Full |
| 2025/12/11 | 1832 | Partial |
| 2025/12/12 | 2139 | Partial |
| 2025/12/18 | 1656 | Partial |
| 2025/12/23 | 4042 | Holiday week |
| 2025/12/26 | 24 | Holiday |
| 2025/12/30 | 4188 | Holiday week |
| 2025/12/31 | 7932 | Full |
| 2026/01/01 | 7944 | Full |
| 2026/01/02 | 7876 | Full |
| 2026/01/03 | 4632 | Partial |
| 2026/01/04 | 7926 | Full |
| 2026/01/05 | 7946 | Full |
| 2026/01/06 | 7969 | Full |
| 2026/01/07 | 7932 | Full |
| 2026/01/08 | 7924 | Full |
| 2026/01/09 | 8130 | Full |
| 2026/01/10 | 4634 | Partial |
| 2026/01/11 | 7920 | Full |
| 2026/01/12 | 8320 | Full |
| 2026/01/13 | 7662 | Full |
| 2026/01/14 | 8256 | Full |
| 2026/01/15 | 5510 | Partial |
| 2026/01/16 | 5604 | Partial |
| 2026/01/17 | 5112 | Partial |
| 2026/01/18 | 7830 | Full |
| 2026/01/19 | 8090 | Full |
| 2026/01/20 | 8412 | Full |
| 2026/01/21 | 8402 | Full |
| 2026/01/22 | 2540 | Today (partial) |

**Observations:**
- Full weekday: ~7900-8400 files
- Weekends/holidays: reduced counts
- Best test date: 2026/01/21 (8402 files)

**Equity File Categories (from tree analysis):**

| Category | Unique Files | Current Map |
|----------|--------------|-------------|
| equityOptions* | 260 | EXCLUDED |
| equityIndex* | 50 | EXCLUDED |
| equityWarrant* | 47 | Partial |
| equitySec* | 10 | Partial |
| equityIndia* | 5 | Partial |
| equityMifid* | 8 | Partial |
| Core equity | 135 | Covered |
| **Total** | 548 | - |

---

## Tasks

- [x] Verify equities mapping coverage
- [x] Run DQ validation for equities
- [x] Analyze futures mapping requirements
- [ ] Create futures_extended grabber maps (1.0, 2.0, 3.0)

---

### DQ Validation - Equities

**Command:**
```bash
cd /home/thanumahee/dev/alchmy/data-alchemy && source .env && uv run python -m data_alchemy.main --vendor bloomberg --dataset bbocax_cwiq_pipe --version 1.0 --dq --dq-date-range 20260101:20260111 --file-pattern ".*equity.*"
```

**Results:**
- `back_office_equities/1.0`: **PASSED** (11 dates, 699 files checked)
- Type mismatch warnings: output is gzip, reference is text/plain (expected)

**File Counts per Date (`back_office_equities/1.0/raw`):**

| Period | Weekday | Weekend |
|--------|---------|---------|
| Oct 11 - Nov 16, 2025 | 68 | 28 |
| Nov 17, 2025 | 157 (transition) | - |
| Nov 18, 2025+ | **210** | **82** |

**File Extensions (sample 20260108):**
- .csv: 75, .parquet: 67, .out: 20, .dif: 20, .px: 11, .hpc: 11, .rpx: 6
- Total: 210 files/weekday

---

### Futures Mapping Analysis

**Current State:**
- `futures_2_0.json` handles `*FuturesBulk*` → `back_office_futures/2.0` ✅ CORRECT

**Missing - FuturesExtended:**

Production structure on ny5-predpalch01:
```
/sf/data/bloomberg/back_office_futures_extended/
├── 1.0/raw/{share,non_share}_futures_extended/
├── 2.0/raw/{share,non_share}_futures_extended/
└── 3.0/raw/{share,non_share}_futures_extended/
```

**Version mapping (from shovel):**

| Filename Pattern | Target Version |
|------------------|----------------|
| `*FuturesExtended*` (no V suffix) | 1.0 |
| `*FuturesExtended*V2*` | 2.0 |
| `*FuturesExtended*V3*` | 3.0 |

**Need to create:**
1. `bloomberg_bbocax_cwiq_pipe_futures_extended_1_0.json`
2. `bloomberg_bbocax_cwiq_pipe_futures_extended_2_0.json`
3. `bloomberg_bbocax_cwiq_pipe_futures_extended_3_0.json`

---

## Commands Reference

```bash
# Count files per date in bronze
find /sf/data/bloomberg/bbocax_cwiq_pipe/1.0/bronze -mindepth 3 -maxdepth 3 -type d -exec sh -c 'echo "$(find "$1" -type f | wc -l) $1"' _ {} \; | sort -k2

# Count equity files for a specific date
find /sf/data/bloomberg/bbocax_cwiq_pipe/1.0/bronze/2026/01/21 -type f -name "*equity*" | wc -l

# List unique equity filenames
find /sf/data/bloomberg/bbocax_cwiq_pipe/1.0/bronze/2026/01/21 -type f -name "*equity*" | sed 's|.*/||' | sed 's/--.*$//' | sort -u
```
