# Session: 2026-01-20 (Linux)

## ClickUp CLI Setup

### Installed
- **clickup-cli** (npm) installed locally in `/home/thanumahee/dev/alchmy/`
- Run with: `npx clickup-cli <command>`

### Config
- Location: `~/.clickup/config.json`
- API Token configured

### Teams
| Team | ID |
|------|-----|
| Test | 90181127218 |
| CodeWilling | 9005044077 |

### CodeWilling Spaces
| Space | ID |
|-------|-----|
| Quantbot Space | 90050095909 |
| CodeWilling Space | 90050095912 |
| Schonfeld Space | 90050095929 |
| CodeWilling Archive | 90060077859 |
| CodeWilling Data Space | 90111413693 |
| ATC Project Management | 90113617595 |
| ApiIntegration | 90113699257 |
| Quick Start: Product Management | 90113944715 |
| Beacon | 90113985915 |

### CLI Commands
```bash
# Create task
npx clickup-cli create "Task Name" -l <list_id>

# Update task
npx clickup-cli update <task_id> "New Name"

# Delete task
npx clickup-cli delete <task_id>

# Add comment
npx clickup-cli comment <task_id> "message"

# Help
npx clickup-cli --help
```

### API Curl Examples
```bash
# Get teams
curl -s -H "Authorization: <token>" "https://api.clickup.com/api/v2/team"

# Get spaces
curl -s -H "Authorization: <token>" "https://api.clickup.com/api/v2/team/<team_id>/space?archived=false"

# Get folders
curl -s -H "Authorization: <token>" "https://api.clickup.com/api/v2/space/<space_id>/folder?archived=false"

# Get lists
curl -s -H "Authorization: <token>" "https://api.clickup.com/api/v2/folder/<folder_id>/list?archived=false"
```

### Next Steps
- Get folder/list IDs to complete config
- Update `~/.clickup/config.json` with default list ID

---

## BBocax Equities Mapping

### Branch
- `feature/bbocax-equities` (28 commits ahead of origin)
- Fresh combined branch: `feature/bbocax-combined-mapping-v2` (pushed)

### Files Created/Modified

**Grabber Maps:**
1. `bloomberg_bbocax_cwiq_pipe_equities_1_0.json` - CSV + binary files with `gzip_no_ext`
   - Patterns: csv, out, dif, px, rpx, px.hpc
   - Excludes: equityOptions, equityIndex

2. `bloomberg_bbocax_cwiq_pipe_equities_parquet_1_0.json` - NEW
   - Parquet files without compression (Apache Parquet native)

**Silver Decrypt Inclusions:**
- Added to `resc/silver_decrypt_inclusions/bloomberg.json`:
  - `equity_.*\\.(?:out|dif)\\.gz\\.enc`
  - `equitySec13f2.*\\.(?:out|dif)\\.gz\\.enc`
  - `equityWarrant.*\\.(?:out|dif)\\.gz\\.enc`

### Compression Strategy
| File Type | Compression | Grabber Map |
|-----------|-------------|-------------|
| .csv | gzip_no_ext | equities_1_0.json |
| .out | gzip_no_ext | equities_1_0.json |
| .dif | gzip_no_ext | equities_1_0.json |
| .px | gzip_no_ext | equities_1_0.json |
| .rpx | gzip_no_ext | equities_1_0.json |
| .px.hpc | gzip_no_ext | equities_1_0.json |
| .parquet | None | equities_parquet_1_0.json |

### Key Learnings
- `compression` in metadata applies to entire grabber map file
- Need separate grabber maps for different compression needs
- Reference files: csv/out/dif/px/rpx/hpc are gzip, parquet is NOT gzipped
- `filetype` module available for verifying actual file type (magic bytes)

### Currency DQ - Complete Dates (15 files)
Good ranges for DQ validation:
- `20251201:20251205` (5 days)
- `20251214:20251217` (4 days)

### Commands Reference
```bash
# Equities backfill
uv run python -m data_alchemy.main --vendor bloomberg --dataset bbocax_cwiq_pipe --backfill 2160 --file-pattern '.*equity.*' --ignore-db

# Currency DQ with date range
uv run python -m data_alchemy.main --vendor bloomberg --dataset bbocax_cwiq_pipe --dq --dq-date-range 20251214:20251217 --file-pattern '.*curncy.*'

# Compare file counts (processed vs reference)
for date_dir in $(find /sf/data/bloomberg/back_office_currency/1.0/raw -mindepth 2 -maxdepth 2 -type d 2>/dev/null | sort); do
  date=$(basename $date_dir)
  year=$(basename $(dirname $date_dir))
  ref_count=$(find /sf/data/bloomberg/back_office_currency/$year/$date -type f 2>/dev/null | wc -l)
  proc_count=$(find $date_dir -type f 2>/dev/null | wc -l)
  if [ "$ref_count" != "$proc_count" ]; then
    echo "MISMATCH $date: ref=$ref_count proc=$proc_count"
  fi
done
```

### --ignore-db Behavior
| Phase | Normal Mode | With --ignore-db |
|-------|-------------|------------------|
| Phase 1 (Raw→Bronze) | Scan raw, check DB | Scan raw, check DB (same) |
| Phase 2 (Bronze→Silver) | Query DB | Scan bronze on disk |
| Phase 3 (Silver→Gold) | Query DB | Scan silver on disk |
