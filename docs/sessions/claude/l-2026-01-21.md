# Session: 2026-01-21 (Linux)

## Summary
Monitored bbocax_cwiq_pipe pipeline run and verified file system writes between Gold (`/sf/data/`) and Platinum (`/sf/proj/`).

## Pipeline Run: bbocax_cwiq_pipe

### Command
```bash
uv run python -m data_alchemy.main --vendor bloomberg --dataset bbocax_cwiq_pipe --backfill 5000 --ignore-db 2>&1 | tee ~/bbocax_all.log
```

### Results
- **Bronze:** 216,404 files (completed)
- **Silver:** 216,400 files (completed)
- **Gold:** 97,737 files (completed)
- **Total time:** ~4.3 hours

**Note:** `MOVE_PRODUCTION_FILES` was not set, so unmapped files were skipped.

## File System Verification

### Currency Dataset Comparison
**Paths:**
- Gold: `/sf/data/bloomberg/back_office_currency/1.0/raw/`
- Platinum: `/sf/proj/data_alchemy/assets/cdp_out/bloomberg/back_office_currency/1.0/raw/`

**File structure per date (15 files):**
- 5 x `.out` files
- 5 x `.csv` files
- 5 x `.parquet` files

### Good Dates (Gold = Platinum)
**30 dates with matching counts (15 = 15):**
```
2025: Nov 18-21, 23-28, 30, Dec 1-5, 7, 12, 14-17, 19, 21-22, 24-26, 28-29
```

**Good date range for DQ:**
```
20251118:20251207
```

### Bad Dates (Mismatch)
- Oct 12 - Nov 17: Gold has 5 files, Platinum has 15
- Some Dec dates: Partial files
- 2026 Jan 1-8: Gold has 0, Platinum has 96 files

## DQ Commands

### Check currency with good date range
```bash
uv run python -m data_alchemy.main --vendor bloomberg --dataset bbocax_cwiq_pipe --version 1.0 --dq --dq-date-range 20251118:20251207
```

### With verbose output
```bash
LOG_LEVEL=DEBUG uv run python -m data_alchemy.main --vendor bloomberg --dataset bbocax_cwiq_pipe --version 1.0 --dq --dq-date-range 20251118:20251207 --verbose-dq 2>&1 | tee ~/dq_report.log
```

## Key Findings

1. **back_office_currency** has no grabber maps - must run DQ via `bbocax_cwiq_pipe`
2. **File type mismatches** can be ignored
3. **Raw/Gold validation passed** for 20251118:20251207 (Total Errors: 0)
4. **2026 data missing in Gold** - pipeline ran without MOVE_PRODUCTION_FILES

---

## Unmapped Files Analysis

### Current Grabber Maps (feature/bbocax-currency branch)
| Grabber Map | Target Dataset |
|-------------|----------------|
| currency_1_0.json | back_office_currency |
| currency_parquet_1_0.json | back_office_currency |
| backoffice_1_0.json | back_office_preferred_exch_corporate_actions |
| backoffice_cax_1_0.json | back_office_preferred_exch_corporate_actions |
| corporate_actions_1_0.json | corporate_actions |
| corporate_actions_cax_1_0.json | corporate_actions |
| futures_2_0.json | back_office_futures |

### Unmapped File Count by Extension
| Extension | Count |
|-----------|-------|
| csv | 635 |
| parquet | 386 |
| pdf | 64 |
| cax | 19 |
| xlsx | 18 |
| json | 14 |
| out | 4 |
| dif | 2 |

### All Unmapped Datasets (Need Grabber Maps)

| Target Dataset | File Patterns |
|----------------|---------------|
| **back_office_equity** | equity*.csv, equity*.parquet, equity*.cax |
| **back_office_equity_options** | equityOptions*.csv/parquet, equityIndexOptions*.csv/parquet |
| **back_office_equity_warrant** | equityWarrant*.csv/parquet |
| **back_office_corporate_preferred** | corpPfd*.csv/parquet, corpPfdConvert*.csv/parquet |
| **back_office_futures_extended** | shareFuturesExtended*.csv/parquet, nonShareFuturesExtended*.csv/parquet |
| **back_office_govt_national** | govtNational*.csv/parquet |
| **back_office_govt_agency** | govtAgencyRegl*.csv/parquet |
| **back_office_preferred_exchange** | pfdExch*.csv/parquet, effDtPfdExch*.cax |
| **back_office_credit_risk** | creditRisk*.csv/parquet |
| **back_office_funds** | fundsSecf*.csv/parquet |
| **back_office_sanctions** | global*Sanctions*.csv/parquet |
| **back_office_secf** | equitySecf*, preferredSecf*, warrantSecf* |
| **back_office_mifid** | equityMifid*.csv/parquet |
| **back_office_misc** | tickSizeTable, legalEntityNace, globalFigiLookup, northAmericanIndustryClassificationSystem |
| **back_office_premarket** | premarketEquity*.cax/parquet |
| **back_office_india** | equityIndiaDaysToSettle* |
| **metadata/notices (skip)** | alert*.pdf, *_DL_v*.xlsx/pdf, Weekly_Data_License_Notice*, Global*.json, fields.*, condition_code.*, lookup.*, economistEstimates*.out |

**Total: ~17 target datasets need grabber maps**
