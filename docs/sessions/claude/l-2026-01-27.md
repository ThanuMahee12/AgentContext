# Session: 2026-01-27 (Linux)

## Context
- **Repo**: alchmy
- **Branch**: feature/bbocax-additional-split-services (data-alchemy)

## Synced from Windows Session

See `w-2026-01-27.md` for full context including:
- rsync commands for bloomberg data copy
- BBOCAX split service commands (8 patterns)
- Bloomberg DES binary issue
- Python venv setup on remote server

---

## Next Steps (from Windows)
- [ ] Complete rsync copy of bloomberg data
- [ ] Run data-alchemy with split service patterns
- [ ] Fix Bloomberg DES binary path
- [ ] Merge feature/backfill-date-range-clean to dev
- [ ] Merge feature/bbocax-preferred-exch to dev
- [ ] Implement per-dataset backfill hours configuration

---

## Work Done (Linux)

### bbocax Equities Branch Setup

**Branch:** `feature/bbocax-equities`

**Actions:**
1. Merged `origin/dev` - resolved conflict in `silver_decrypt_inclusions/bloomberg.json`
2. Cherry-picked equities service files from `feature/bbocax-additional-split-services`
3. Added equities to Ansible playbooks
4. Fixed grabber map patterns to exclude CorporateActions files

### Commits Pushed

| Commit | Description |
|--------|-------------|
| `43c2f3c` | merge origin/dev into feature/bbocax-equities |
| `f99c195` | feat: add back_office_equities service files for bbocax |
| `6ab9349` | docs: add back_office_equities to ansible playbooks |
| `7656739` | fix: exclude CorporateActions from equities grabber map patterns |

**MR:** [!490](https://git.codewilling.com/data/cwiq-pipe/data-alchemy/-/merge_requests/490)

### Grabber Map Fix (CorporateActions Exclusion)

**Issue:** Test failures showed `equityAsia1CorporateActionsV2.parquet` incorrectly matched by equities grabber map instead of going to corporate_actions 2.0.

**Pattern Change:**
```
# Before
equity(?!Options|Index)[^/]*

# After
equity(?!Options|Index)(?!.*CorporateActions)[^/]*
```

**Files Updated:**
- `resc/grabber_maps/bloomberg_bbocax_cwiq_pipe_equities_parquet_1_0.json`
- `resc/grabber_maps/bloomberg_bbocax_cwiq_pipe_equities_1_0.json`

**Service Files:** Already correct - FILE_PATTERN has `(?!.*(CorporateActions|\.cax))` exclusion.

### Playbook Status

| Playbook | Status |
|----------|--------|
| `deploy-data-alchemy-prod06.yml` | Equities commented out |
| `deploy-data-alchemy-staging.yml` | Equities active |
| `deploy-data-alchemy-prod.yml` | No equities entries |

### Equities FILE_PATTERN (Verified)

```
(equity(Asia1|Asia2|Euro|Lamr|Namr|MifidEuro)(?!.*(CorporateActions|\.cax))|equity_(asia1|asia2|euro|lamr|namr|mifid_euro)(?!\.cax))
```

**Coverage:** 118 files/weekday (78 CamelCase + 40 underscore)

### Platinum Verification

| Date Type | Files |
|-----------|-------|
| Weekdays | 118 |
| Weekends | 48 |

**DQ orphaned files:** Expected (CDP reference incomplete)

### Run Command

```bash
uv run python -m data_alchemy.main \
    --vendor bloomberg \
    --dataset bbocax_cwiq_pipe \
    --version 1.0 \
    --backfill 5000 \
    --ignore-db \
    --db-name '{vendor}--{ds}--back_office_equities' \
    --file-pattern '(equity(Asia1|Asia2|Euro|Lamr|Namr|MifidEuro)(?!.*(CorporateActions|\.cax))|equity_(asia1|asia2|euro|lamr|namr|mifid_euro)(?!\.cax))' \
    2>&1 | tee ~/bbocax_equities_$(date +%Y%m%d_%H%M%S).log
```

---
