# l-2026-01-12

## Project: data-alchemy (bbocax mapping)

**Environment:** Linux machine (`l-` prefix)

**Continued from:** w-2026-01-11 (bbocax mapping section)

**Branch:** `feature/bbocax-new-mapping`

---

### Summary

Analyzed bbocax_cwiq_pipe files and determined what needs mapping vs what sf-storage-migration handles.

---

### Key Finding: sf-storage-migration vs data-alchemy

**sf-storage-migration handles (from /mktdata/BLOOMBERG/):**

| Handler | Source Dataset | Target | Status |
|---------|----------------|--------|--------|
| back_office_convert_bonds | CORPORATE_AND_PREFERRED_CONVERTIBLE_BONDS | ✅ | IGNORE |
| back_office_gov_bonds | SOVEREIGN_BONDS | ✅ | IGNORE |
| back_office_preferred_bonds | CORPORATE_AND_PREFERRED_BONDS | ✅ | IGNORE |
| corporate_actions | CORPORATE_ACTIONS | ✅ | IGNORE |
| corporate_events_calendar | EID46835 | ✅ | IGNORE |
| global_economic_indicators | GECO | ✅ | IGNORE |
| market_calendar | BBOCAL | ✅ | IGNORE |
| quantbeam | RTMD | ✅ | IGNORE |

**data-alchemy handles (from bbocax_cwiq_pipe):**

| Target Directory | bbocax Files | Encrypted | Status |
|------------------|--------------|-----------|--------|
| back_office_futures | shareFutures*, nonShareFutures* | ~317 | ❌ TODO |
| back_office_futures_extended | *Extended* | (part of above) | ❌ TODO |
| back_office_equities | equity* (base files) | 91 | ❌ TODO |
| back_office_preferred_exch | pfdExch*, pfd_exch* (base) | 52 | ❌ TODO |
| back_office_supplemental | condition_code, lookup, fields | 9 | ❌ TODO |
| back_office_currency | curncy* | 5 | ❌ TODO |
| back_office_commodity | comdty* | 0 | N/A (not in cwiq-pipe) |

**Already done:**
- ✅ back_office_preferred_exch_corporate_actions (8 grabber maps)
- ✅ corporate_actions (from .cax files)

---

### Target Paths (from /sf/data/bloomberg/)

```
/sf/data/bloomberg/
├── back_office_commodity/1.0/raw/
├── back_office_convert_bonds/1.0/raw/      ← sf-migration
├── back_office_currency/1.0/raw/           ← TODO
├── back_office_equities/1.0/raw/           ← TODO
├── back_office_futures/1.0/raw/            ← TODO
├── back_office_futures_extended/1.0/raw/   ← TODO
├── back_office_gov_bonds/1.0/raw/          ← sf-migration
├── back_office_preferred_bonds/1.0/raw/    ← sf-migration
├── back_office_preferred_exch/1.0/raw/     ← TODO
├── back_office_preferred_exch_corporate_actions/1.0/raw/  ← DONE
├── back_office_supplemental/1.0/raw/       ← TODO
├── corporate_actions/1.0/raw/              ← DONE
└── ...
```

---

### bbocax Approach

**3-Step process per category:**

1. **Add decrypt inclusions** → `resc/silver_decrypt_inclusions/bloomberg.json`
2. **Add unzip exclusions** (if needed) → `resc/silver_unzip_exclusions/bloomberg.json`
3. **Create grabber maps** → route silver → platinum

**File types:**
- Encrypted (.enc): 891 unique patterns - need decrypt inclusions
- Gzip only (.gz): 657 patterns - just compressed
- Plain: 502 - xlsx, pdf notices

---

### Grabber Maps Created (6 mappings) ✅

| # | Category | Grabber Map | Target | Status |
|---|----------|-------------|--------|--------|
| 1 | futures | `bloomberg_bbocax_cwiq_pipe_futures_1_0.json` | back_office_futures/1.0/raw/ | ✅ DONE |
| 2 | futures_extended | `bloomberg_bbocax_cwiq_pipe_futures_extended_1_0.json` | back_office_futures_extended/1.0/raw/ | ✅ DONE |
| 3 | equity | `bloomberg_bbocax_cwiq_pipe_equities_1_0.json` | back_office_equities/1.0/raw/ | ✅ DONE |
| 4 | preferred_exch | `bloomberg_bbocax_cwiq_pipe_preferred_exch_1_0.json` | back_office_preferred_exch/1.0/raw/ | ✅ DONE |
| 5 | supplemental | `bloomberg_bbocax_cwiq_pipe_supplemental_1_0.json` | back_office_supplemental/1.0/raw/ | ✅ DONE |
| 6 | currency | `bloomberg_bbocax_cwiq_pipe_currency_1_0.json` | back_office_currency/1.0/raw/ | ✅ DONE |

**File patterns mapped:**

| Grabber Map | Source Patterns |
|-------------|-----------------|
| futures | `globalShareFuturesSanctions*` |
| futures_extended | `shareFuturesExtended*`, `nonShareFuturesExtended*` |
| equities | `equity*` (excludes Options/Index), `equityWarrant*`, `equitySec13f2*` |
| preferred_exch | `pfdExch*Pricing*`, `pfdExch*HistoricalPricing*` |
| supplemental | `condition_code.out`, `fields.csv`, `fields.dif`, `tickSizeTable*` |
| currency | `curncy*` |

**Ignored (no target path or sf-migration handles):**
- bonds (govt*, corpPfd*) → sf-storage-migration handles
- calendar → sf-storage-migration handles (BBOCAL)
- equityOptions → no target directory exists
- equityIndexOptions → no target directory exists

---

### Reference Files

- Shovel mapping: `tfe-cdp-shovel/shovel/dataset_mapping/bbo.py`
- Product mapping: `tfe-cdp-shovel/shovel/dataset_mapping/bbo_product_mapping.json`
- sf-storage-migration handlers: `/home/thanumahee/dev/sf-storage-migration/gpfs_fsdb_mapping/mapping/handlers/bloomberg/`
- bbocax source tree: `asserts/tree/crawler/bloomberg-bbocax_cwiq_pipe-1.0-tree.json`

---

### Next Steps

1. Test pipeline with new grabber maps
2. Run with `--default-mapping` to find uncategorized files
3. Verify gold output paths match expected structure
4. Deploy to production

---
