# l-2026-01-12

## Project: data-alchemy (bbocax mapping)

**Environment:** Linux machine (`l-` prefix)

**Continued from:** w-2026-01-11 (bbocax mapping section)

**Branch:** `feature/bbocax-new-mapping`

---

### Summary

Created 6 grabber maps for bbocax_cwiq_pipe → back_office_* targets. Verified target structure from `/sf/proj/data_alchemy/assets/cdp_out/bloomberg/`.

---

### Key Finding: sf-storage-migration vs data-alchemy

**sf-storage-migration handles (from /mktdata/BLOOMBERG/):**

| Handler | Source Dataset | Target | Status |
|---------|----------------|--------|--------|
| back_office_convert_bonds | CORPORATE_AND_PREFERRED_CONVERTIBLE_BONDS | ✅ | IGNORE |
| back_office_gov_bonds | SOVEREIGN_BONDS | ✅ | IGNORE |
| back_office_preferred_bonds | CORPORATE_AND_PREFERRED_BONDS | ✅ | IGNORE |
| corporate_actions | CORPORATE_ACTIONS | ✅ | IGNORE |
| corporate_events_calendar | EID46835 | ✅ | IGNORE |
| global_economic_indicators | GECO | ✅ | IGNORE |
| market_calendar | BBOCAL | ✅ | IGNORE |
| quantbeam | RTMD | ✅ | IGNORE |

**data-alchemy handles (from bbocax_cwiq_pipe):**

| Target Directory | bbocax Files | Status |
|------------------|--------------|--------|
| back_office_futures | globalShareFuturesSanctions* | ✅ DONE |
| back_office_futures_extended | shareFuturesExtended*, nonShareFuturesExtended* | ✅ DONE |
| back_office_equities | equity* (not Options/Index), equityWarrant*, equitySec13f2* | ✅ DONE |
| back_office_preferred_exch | pfdExch*Pricing*, pfdExch*HistoricalPricing* | ✅ DONE |
| back_office_supplemental | condition_code.out, fields.csv, fields.dif | ✅ DONE |
| back_office_currency | curncy* | ✅ DONE |

---

### Target Structure (verified from /sf/proj)

```
/sf/proj/data_alchemy/assets/cdp_out/bloomberg/
├── back_office_currency/1.0/raw/YYYY/YYYYMMDD/
├── back_office_equities/1.0/raw/YYYY/YYYYMMDD/
├── back_office_futures/1.0/raw/YYYY/YYYYMMDD/           ← (empty/not used?)
├── back_office_futures_extended/1.0/raw/
│   ├── share_futures_extended/YYYY/YYYYMMDD/            ← subdirectory!
│   └── non_share_futures_extended/YYYY/YYYYMMDD/        ← subdirectory!
├── back_office_preferred_exch/1.0/raw/YYYY/YYYYMMDD/
└── back_office_supplemental/1.0/raw/YYYY/YYYYMMDD/
```

**Key findings:**
- Files are **NOT gzip compressed** in target (plain .csv, .parquet)
- `futures_extended` has **subdirectories** for share vs non_share
- Other directories have direct YYYY/YYYYMMDD structure

---

### Grabber Maps Created (6 mappings) ✅

| # | Grabber Map | Target | Subdirectory |
|---|-------------|--------|--------------|
| 1 | `bloomberg_bbocax_cwiq_pipe_futures_1_0.json` | back_office_futures/1.0/raw/ | No |
| 2 | `bloomberg_bbocax_cwiq_pipe_futures_extended_1_0.json` | back_office_futures_extended/1.0/raw/ | Yes: share_/non_share_ |
| 3 | `bloomberg_bbocax_cwiq_pipe_equities_1_0.json` | back_office_equities/1.0/raw/ | No |
| 4 | `bloomberg_bbocax_cwiq_pipe_preferred_exch_1_0.json` | back_office_preferred_exch/1.0/raw/ | No |
| 5 | `bloomberg_bbocax_cwiq_pipe_supplemental_1_0.json` | back_office_supplemental/1.0/raw/ | No |
| 6 | `bloomberg_bbocax_cwiq_pipe_currency_1_0.json` | back_office_currency/1.0/raw/ | No |

**Pattern features:**
- All patterns handle optional `.gz` suffix: `(?:\.gz)?`
- Files with date suffix (`.csv.20251213`) → extract date from suffix
- Files without date suffix → use silver directory date
- `futures_extended` routes `shareFuturesExtended*` → `share_futures_extended/` and `nonShareFuturesExtended*` → `non_share_futures_extended/`

---

### File Pattern Details

| Grabber Map | Source Patterns | Extensions |
|-------------|-----------------|------------|
| futures | `globalShareFuturesSanctions*` | .csv, .parquet |
| futures_extended | `shareFuturesExtended*`, `nonShareFuturesExtended*` | .csv, .parquet |
| equities | `equity(?!Options|Index)*`, `equityWarrant*`, `equitySec13f2*` | .csv, .parquet |
| preferred_exch | `pfdExch*Pricing*`, `pfdExch*HistoricalPricing*` | .csv, .parquet |
| supplemental | `condition_code.out`, `fields.csv`, `fields.dif` | .out, .csv, .dif |
| currency | `curncy*` | .csv, .parquet |

**Note:** tickSizeTable removed from supplemental (not in /sf/proj target)

---

### Ignored (no target or sf-migration handles)

- bonds (govt*, corpPfd*) → sf-storage-migration
- calendar → sf-storage-migration (BBOCAL)
- equityOptions → no target directory
- equityIndexOptions → no target directory

---

### Reference Files

- Target verification: `/sf/proj/data_alchemy/assets/cdp_out/bloomberg/`
- Shovel mapping: `tfe-cdp-shovel/shovel/dataset_mapping/bbo.py`
- sf-storage-migration handlers: `/home/thanumahee/dev/sf-storage-migration/gpfs_fsdb_mapping/mapping/handlers/bloomberg/`
- Silver files: `/sf/data/bloomberg/bbocax_cwiq_pipe/1.0/silver/`

---

### Next Steps

1. Test pipeline with new grabber maps
2. Run with `--default-mapping` to find uncategorized files
3. Verify gold output paths match `/sf/proj` structure
4. Deploy to production

---
